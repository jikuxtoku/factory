-- [[ JINHUB - INDEX LOADER V.0.60 (OPTIMIZED) ]] --

getgenv().HubVersion = "v0.60" 

local CoreGui = game:GetService("CoreGui")
local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")
local LP = Players.LocalPlayer

-- Clean up existing UI to prevent memory leaks
if getgenv().JinIndexUI then 
    pcall(function() getgenv().JinIndexUI:Destroy() end) 
end

-- [[ THEME CONFIGURATION ]] --
local Theme = { 
    Bg = Color3.fromRGB(30, 30, 30), 
    Header = Color3.fromRGB(45, 45, 45), 
    Item = Color3.fromRGB(60, 60, 60), 
    Text = Color3.fromRGB(255, 255, 255), 
    Accent = Color3.fromRGB(100, 100, 100), 
    TabBg = Color3.fromRGB(20, 20, 20) 
}

-- [[ MAIN UI SETUP ]] --
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "Jinny Hub"
ScreenGui.ResetOnSpawn = false
getgenv().JinIndexUI = ScreenGui

pcall(function() ScreenGui.Parent = CoreGui end)
if not ScreenGui.Parent then ScreenGui.Parent = LP.PlayerGui end

local JINBtn = Instance.new("TextButton")
JINBtn.BackgroundColor3 = Theme.Accent
JINBtn.BackgroundTransparency = 0.5
JINBtn.Position = UDim2.new(0.1, 0, 0.1, 0)
JINBtn.Size = UDim2.new(0, 50, 0, 50)
JINBtn.Text = "JIN"
JINBtn.TextColor3 = Color3.new(1, 1, 1)
JINBtn.Font = Enum.Font.GothamBlack
JINBtn.TextSize = 22
JINBtn.Visible = false
local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(1, 0)
btnCorner.Parent = JINBtn
JINBtn.Parent = ScreenGui

local Main = Instance.new("Frame")
Main.BackgroundColor3 = Theme.Bg
Main.BackgroundTransparency = 0.5
Main.Position = UDim2.new(0.5, -250, 0.5, -160)
Main.Size = UDim2.new(0, 500, 0, 320)
local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 8)
mainCorner.Parent = Main
local MS = Instance.new("UIStroke")
MS.Color = Theme.Accent
MS.Thickness = 1.5
MS.Transparency = 0.5
MS.Parent = Main
Main.Parent = ScreenGui

local function MakeDraggable(frame, trigger) 
    local dragging, dragInput, dragStart, startPos
    trigger.InputBegan:Connect(function(input) 
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then 
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function() 
                if input.UserInputState == Enum.UserInputState.End then dragging = false end 
            end) 
        end 
    end)
    trigger.InputChanged:Connect(function(input) 
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then 
            dragInput = input 
        end 
    end)
    UIS.InputChanged:Connect(function(input) 
        if input == dragInput and dragging then 
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y) 
        end 
    end) 
end

MakeDraggable(Main, Main)
MakeDraggable(JINBtn, JINBtn)

local Header = Instance.new("Frame")
Header.BackgroundColor3 = Theme.Header
Header.BackgroundTransparency = 0.5
Header.Size = UDim2.new(1, 0, 0, 40)
local headerCorner = Instance.new("UICorner")
headerCorner.CornerRadius = UDim.new(0, 8)
headerCorner.Parent = Header
Header.Parent = Main

local HeaderHide = Instance.new("Frame")
HeaderHide.BackgroundColor3 = Theme.Header
HeaderHide.BackgroundTransparency = 0.5
HeaderHide.Size = UDim2.new(1, 0, 0.5, 0)
HeaderHide.Position = UDim2.new(0, 0, 0.5, 0)
HeaderHide.BorderSizePixel = 0
HeaderHide.Parent = Header

local Title = Instance.new("TextLabel")
Title.Text = " JinHub " .. getgenv().HubVersion
Title.TextColor3 = Theme.Text
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 16
Title.Size = UDim2.new(0.5, 0, 1, 0)
Title.BackgroundTransparency = 1
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

local MinBtn = Instance.new("TextButton")
MinBtn.Size = UDim2.new(0, 30, 0, 26)
MinBtn.Position = UDim2.new(1, -38, 0, 7)
MinBtn.Text = "-"
MinBtn.BackgroundColor3 = Theme.Item
MinBtn.BackgroundTransparency = 0.5
MinBtn.TextColor3 = Color3.new(1, 1, 1)
MinBtn.Font = Enum.Font.GothamBold
MinBtn.TextSize = 18
local minCorner = Instance.new("UICorner")
minCorner.CornerRadius = UDim.new(0, 6)
minCorner.Parent = MinBtn
MinBtn.Parent = Header

local function ToggleUI() 
    Main.Visible = not Main.Visible
    JINBtn.Visible = not Main.Visible
    if JINBtn.Visible then 
        JINBtn.Position = Main.Position 
    else 
        Main.Position = JINBtn.Position 
    end 
end

MinBtn.MouseButton1Click:Connect(ToggleUI)
JINBtn.MouseButton1Click:Connect(ToggleUI)

-- [[ TAB SYSTEM & INJECTION ]] --
local TabContainer = Instance.new("Frame")
TabContainer.Size = UDim2.new(0, 130, 1, -40)
TabContainer.Position = UDim2.new(0, 0, 0, 40)
TabContainer.BackgroundColor3 = Theme.TabBg
TabContainer.BackgroundTransparency = 0.5
TabContainer.BorderSizePixel = 0
TabContainer.Parent = Main

local TabListLayout = Instance.new("UIListLayout")
TabListLayout.Padding = UDim.new(0, 5)
TabListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
TabListLayout.Parent = TabContainer

local PageContainer = Instance.new("Frame")
PageContainer.Size = UDim2.new(1, -140, 1, -50)
PageContainer.Position = UDim2.new(0, 135, 0, 45)
PageContainer.BackgroundTransparency = 1
PageContainer.Parent = Main

local Tabs = {}
local Pages = {}

local function CreateAutoLoadTab(TabName, DescText, LoadLink)
    local TBtn = Instance.new("TextButton")
    TBtn.Size = UDim2.new(0.9, 0, 0, 35)
    TBtn.BackgroundColor3 = Theme.Item
    TBtn.BackgroundTransparency = 0.5
    TBtn.Text = TabName
    TBtn.TextColor3 = Theme.Text
    TBtn.Font = Enum.Font.GothamBold
    TBtn.TextSize = 12
    local tBtnCorner = Instance.new("UICorner")
    tBtnCorner.CornerRadius = UDim.new(0, 6)
    tBtnCorner.Parent = TBtn
    TBtn.Parent = TabContainer
    
    local Page = Instance.new("ScrollingFrame")
    Page.Size = UDim2.new(1, 0, 1, 0)
    Page.BackgroundTransparency = 1
    Page.Visible = false
    Page.BorderSizePixel = 0
    Page.ScrollBarThickness = 2
    Page.ScrollBarImageColor3 = Theme.Accent
    Page.Parent = PageContainer

    local PageLayout = Instance.new("UIListLayout")
    PageLayout.Padding = UDim.new(0, 6)
    PageLayout.SortOrder = Enum.SortOrder.LayoutOrder
    PageLayout.Parent = Page
    
    local LTitle = Instance.new("TextLabel")
    LTitle.Size = UDim2.new(1, 0, 0, 25)
    LTitle.BackgroundTransparency = 1
    LTitle.Text = TabName .. " Module"
    LTitle.TextColor3 = Theme.Text
    LTitle.Font = Enum.Font.GothamBlack
    LTitle.TextSize = 16
    LTitle.TextXAlignment = Enum.TextXAlignment.Left
    LTitle.Parent = Page

    local LDesc = Instance.new("TextLabel")
    LDesc.Size = UDim2.new(1, 0, 0, 30)
    LDesc.BackgroundTransparency = 1
    LDesc.Text = DescText
    LDesc.TextColor3 = Color3.fromRGB(180, 180, 180)
    LDesc.Font = Enum.Font.GothamSemibold
    LDesc.TextSize = 11
    LDesc.TextWrapped = true
    LDesc.TextXAlignment = Enum.TextXAlignment.Left
    LDesc.TextYAlignment = Enum.TextYAlignment.Top
    LDesc.Parent = Page

    local Div = Instance.new("Frame")
    Div.Size = UDim2.new(1, 0, 0, 1)
    Div.BackgroundColor3 = Theme.Item
    Div.BorderSizePixel = 0
    Div.Parent = Page
    
    local StatusLabel = Instance.new("TextLabel")
    StatusLabel.Size = UDim2.new(1, 0, 0, 30)
    StatusLabel.BackgroundTransparency = 1
    StatusLabel.Text = "Click tab to load module..."
    StatusLabel.TextColor3 = Theme.Text
    StatusLabel.Font = Enum.Font.GothamBold
    StatusLabel.TextSize = 12
    StatusLabel.Parent = Page
    
    local isLoaded = false 
    
    TBtn.MouseButton1Click:Connect(function()
        for _, p in pairs(Pages) do p.Visible = false end
        for _, t in pairs(Tabs) do 
            t.BackgroundColor3 = Theme.Item
            t.BackgroundTransparency = 0.5
            t.TextColor3 = Theme.Text 
        end
        Page.Visible = true
        TBtn.BackgroundColor3 = Theme.Accent
        TBtn.BackgroundTransparency = 0.2
        TBtn.TextColor3 = Color3.new(1, 1, 1)
        
        if not isLoaded and LoadLink ~= "" then
            StatusLabel.Text = "⏳ Fetching script..."
            StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
            isLoaded = true 
            
            task.spawn(function()
                -- Network request wrapped in pcall to prevent thread failure
                local success, scriptCode = pcall(function()
                    return game:HttpGet(LoadLink)
                end)
                
                if success and scriptCode then
                    local func, compileErr = loadstring(scriptCode)
                    
                    if func then
                        local runSuccess, runErr = pcall(function()
                            func(Page) 
                        end)
                        
                        if runSuccess then
                            StatusLabel:Destroy()
                        else
                            StatusLabel.Text = "❌ Execution Failed: " .. tostring(runErr)
                        end
                    else
                        StatusLabel.Text = "❌ Compilation Failed!"
                    end
                else
                    StatusLabel.Text = "❌ Network Error or Invalid Link!"
                end
            end)
        end
    end)
    table.insert(Tabs, TBtn)
    table.insert(Pages, Page)
    return Page, TBtn
end

CreateAutoLoadTab("Factory", "Automatically loads the Factory system.", "https://raw.githubusercontent.com/Koziz/CAW-SCRIPT/refs/heads/main/Pabrik.lua")
CreateAutoLoadTab("Auto Farm", "Resource farming system (Wood, Stone).", "https://raw.githubusercontent.com/Koziz/CAW-SCRIPT/refs/heads/main/Autofarm.lua")
CreateAutoLoadTab("Manager", "Inventory & Item Sorting system.", "https://raw.githubusercontent.com/jikuxtoku/autosort/refs/heads/main/autosorted")
